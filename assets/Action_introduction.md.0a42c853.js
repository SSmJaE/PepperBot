import{o as n,c as s,a}from"./app.14b541e2.js";const t='{"title":"? 异常情况","description":"","frontmatter":{},"relativePath":"Action/introduction.md","lastUpdated":1620641730921}',p={},o=a('<div class="danger custom-block"><p class="custom-block-title">WARNING</p><p>行为链尚未实现，这里只是展示行为链可能的样子</p></div><div class="language-py"><pre><code><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n    <span class="token keyword">await</span> actionBot<span class="token punctuation">.</span>selectGroup<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span><span class="token punctuation">.</span>new_notice<span class="token punctuation">(</span>\n        title<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>\n        body<span class="token operator">=</span><span class="token string">&quot;&quot;</span>\n    <span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">await</span> <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroups<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">,</span> <span class="token number">2222</span><span class="token punctuation">,</span> <span class="token number">3333</span><span class="token punctuation">,</span> <span class="token number">4444</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;一条跨群消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Face<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 异常情况</span>\n    <span class="token comment"># 如果机器人不在该群中，会报错，可以try except</span>\n    <span class="token keyword">await</span> <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroup<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>catch<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;一条跨群消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token comment"># ? catchHandler的声明</span>\n    <span class="token comment"># 函数是一等对象的概念</span>\n    <span class="token comment"># 为什么不建议使用匿名函数？</span>\n    <span class="token comment"># 不易理解，没有类型提示，不可复用</span>\n\n    <span class="token comment"># 根据catch标记进行分割片段，捕获每一个片段</span>\n    <span class="token comment"># 比较长的行为链+catch的try except等价实现</span>\n    <span class="token keyword">await</span> <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroups<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">,</span> <span class="token number">2222</span><span class="token punctuation">,</span> <span class="token number">3333</span><span class="token punctuation">,</span> <span class="token number">4444</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;4个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>  <span class="token comment"># 删除不存在的群，不会报错</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;3个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>catch<span class="token punctuation">(</span>catchHandler<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;2个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token number">333</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;1个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 复杂选择操作</span>\n    <span class="token keyword">await</span> <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroups<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">,</span> <span class="token number">2222</span><span class="token punctuation">,</span> <span class="token number">3333</span><span class="token punctuation">,</span> <span class="token number">4444</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;4个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>exclude<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>  <span class="token comment"># 删除不存在的群，不会报错</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;3个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;0个群，此时会报错，被catch拦截&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>catch<span class="token punctuation">(</span>catchHandler<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>include<span class="token punctuation">(</span><span class="token number">5555</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;1个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>include<span class="token punctuation">(</span><span class="token number">6666</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;2个群&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 复用选择结果</span>\n    交流群 <span class="token operator">=</span> actionBot<span class="token punctuation">.</span>selectGroup<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 唯一性数据，直接返回</span>\n    交流群<span class="token punctuation">.</span>admins<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    交流群<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 凡是要返回可迭代数据的，全都是异步生成器</span>\n    交流群<span class="token punctuation">.</span>files<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">async</span> <span class="token keyword">for</span> member <span class="token keyword">in</span> 交流群<span class="token punctuation">.</span>members<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        nickname <span class="token operator">=</span> member<span class="token punctuation">.</span>nickname\n\n        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">&quot;(网课)|(代刷)|(工作室)|(接单)&quot;</span><span class="token punctuation">,</span> nickname<span class="token punctuation">)</span><span class="token punctuation">:</span>\n            <span class="token keyword">await</span> member<span class="token punctuation">.</span>kickout<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">async</span> <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> 交流群<span class="token punctuation">.</span>files<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 不要耦合发送操作(send_message)和获取操作(members)</span>\n    <span class="token comment">#! 不要这样做，错误示例</span>\n    <span class="token comment"># todo 调用members等非run end point时，也在内部执行一次run执行的方法，以适配这种情况</span>\n    getMembersAfterSendMessage <span class="token operator">=</span> <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroup<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;一条跨群消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>members<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token keyword">async</span> <span class="token keyword">for</span> member <span class="token keyword">in</span> getMembersAfterSendMessage<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span>nickname<span class="token punctuation">)</span>\n\n    <span class="token comment"># 分两次，代码更易读，最佳实践</span>\n    <span class="token comment"># 可以复用选择结果</span>\n    targetGroup <span class="token operator">=</span> actionBot<span class="token punctuation">.</span>selectGroup<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># 一个action发送消息</span>\n    <span class="token keyword">await</span> targetGroup<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;一条跨群消息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># 一个action获取群员</span>\n    getMembersIndependently <span class="token operator">=</span> targetGroup<span class="token punctuation">.</span>members<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token keyword">async</span> <span class="token keyword">for</span> member <span class="token keyword">in</span> getMembersIndependently<span class="token punctuation">:</span>\n        <span class="token keyword">print</span><span class="token punctuation">(</span>member<span class="token punctuation">.</span>nickname<span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 对每个群执行同样的操作，通过each或者async_each</span>\n    <span class="token keyword">await</span> <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroups<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">,</span> <span class="token number">2222</span><span class="token punctuation">,</span> <span class="token number">3333</span><span class="token punctuation">,</span> <span class="token number">4444</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>catch<span class="token punctuation">(</span>catchHandler<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>each<span class="token punctuation">(</span>eachGroup<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>async_each<span class="token punctuation">(</span>eachGroup<span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token comment"># ? members，info，files等获取方法上，并没有run方法</span>\n    <span class="token comment"># 这些获取方法和run方法一样，都是行为链的end point</span>\n    <span class="token punctuation">(</span>\n        actionBot\n        <span class="token punctuation">.</span>selectGroup<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span>members<span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token comment"># .run() #! members是end point，无法再调用run方法</span>\n    <span class="token punctuation">)</span>\n\n    <span class="token comment"># ? action分支选择</span>\n    targetUser <span class="token operator">=</span> actionBot<span class="token punctuation">.</span>selectUser<span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">)</span>\n\n    action1 <span class="token operator">=</span> targetUser<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    action2 <span class="token operator">=</span> targetUser<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Face<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    finalAction <span class="token operator">=</span> <span class="token boolean">None</span>\n\n    <span class="token keyword">if</span> <span class="token string">&quot;condition1&quot;</span><span class="token punctuation">:</span>\n        finalAction <span class="token operator">=</span> action1\n    <span class="token keyword">else</span><span class="token punctuation">:</span>\n        finalAction <span class="token operator">=</span> action2\n\n    finalAction<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># ? 批量运行action</span>\n\n    <span class="token comment"># 可以手动运行</span>\n    <span class="token keyword">await</span> targetUser<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">await</span> targetUser<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Face<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># 也可以使用工具函数</span>\n    action1 <span class="token operator">=</span> targetUser<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Text<span class="token punctuation">(</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    action2 <span class="token operator">=</span> targetUser<span class="token punctuation">.</span>send_message<span class="token punctuation">(</span>Face<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n    <span class="token comment"># 只能接受runnable的action，即不能是members，info等为终点的行为链</span>\n    results <span class="token operator">=</span> <span class="token keyword">await</span> ActionRunner<span class="token punctuation">.</span>in_turn<span class="token punctuation">(</span>action1<span class="token punctuation">,</span> action2<span class="token punctuation">)</span>\n    results <span class="token operator">=</span> <span class="token keyword">await</span> ActionRunner<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span>action1<span class="token punctuation">,</span> action2<span class="token punctuation">)</span>\n    results <span class="token operator">=</span> <span class="token keyword">await</span> ActionRunner<span class="token punctuation">.</span>all_settled<span class="token punctuation">(</span>action1<span class="token punctuation">,</span> action2<span class="token punctuation">)</span>\n\n\n<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>\n    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>do_something<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n</code></pre></div>',2);p.render=function(a,t,p,c,e,u){return n(),s("div",null,[o])};export default p;export{t as __pageData};
